{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacaoService","Negociacao","NegociacoesView","MensagemView","Mensagem","DateConverter","getNegociacaoDao","Bind","getExceptionMessage","NegociacaoController","constructor","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_negociacoes","_mensagem","_service","_init","dao","negociacoes","listaTodos","forEach","adiciona","negociacao","err","texto","event","preventDefault","_criaNegociacao","_limpaFormulario","message","value","focus","paraData","parseInt","parseFloat","importaNegociacoes","obtemNegociacoesDoPeriodo","console","log","filter","paraArray","some","novaNegociacao","equals","negociacaoExistente","apaga","apagaTodos","esvazia"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes, NegociacaoService, Negociacao} from '../domain/index.js'; //'../domain/index.js';\r\nimport { NegociacoesView, MensagemView, Mensagem, DateConverter } from '../ui/index.js';\r\nimport { getNegociacaoDao, Bind, getExceptionMessage } from '../util/index.js';\r\n\r\nexport class NegociacaoController{\r\n\r\n  constructor() {\r\n    // a ideia é que $ seja o querySelector\r\n    // realizando o bind, $ mantém document como seu contexto this\r\n    const $ = document.querySelector.bind(document);  \r\n\r\n    // buscando elementos\r\n    this._inputData       = $('#data');\r\n    this._inputQuantidade = $('#quantidade');\r\n    this._inputValor      = $('#valor');\r\n\r\n    //criando o proxy com auxílio do Bind\r\n    this._negociacoes = new Bind(\r\n      new Negociacoes(),\r\n      new NegociacoesView('#negociacoes'),\r\n      'adiciona', 'esvazia'\r\n    );\r\n    \r\n    this._mensagem = new Bind(\r\n      new Mensagem(),\r\n      new MensagemView('#mensagemView'),\r\n      'texto'\r\n    );\r\n    \r\n    this._service = new NegociacaoService();\r\n    \r\n    this._init();\r\n    \r\n  }\r\n\r\n  async _init() {\r\n    try {\r\n      const dao = await getNegociacaoDao();\r\n      const negociacoes = await dao.listaTodos();\r\n      negociacoes.forEach(negociacao => this._negociacoes.adiciona(negociacao));\r\n    } catch(err) {\r\n      \r\n        this._mensagem.texto = getExceptionMessage(err);\r\n    }\r\n  }\r\n\r\n  async adiciona(event) {\r\n\r\n    try {\r\n      // cancelando  a submissão do formulário\r\n      event.preventDefault();\r\n      const negociacao = this._criaNegociacao();\r\n    \r\n      const dao = await getNegociacaoDao();\r\n      await dao.adiciona(negociacao);\r\n      this._negociacoes.adiciona(negociacao);\r\n      this._mensagem.texto = 'Negociação adicionada com sucesso!';\r\n      this._limpaFormulario();\r\n    } catch(err) {\r\n      this._mensagem.texto = err.message;\r\n    }\r\n  }\r\n  \r\n  _limpaFormulario() {\r\n    this._inputData.value       = '';\r\n    this._inputQuantidade.value = 1;\r\n    this._inputValor.value      = 0.0\r\n    this._inputData.focus();\r\n  }\r\n\r\n  _criaNegociacao() {\r\n    //retorna uma instancia de nogociação\r\n    return new Negociacao(\r\n      DateConverter.paraData(this._inputData.value)  ,\r\n      parseInt(this._inputQuantidade.value),\r\n      parseFloat(this._inputValor.value)\r\n    );\r\n  }\r\n  \r\n  async importaNegociacoes() {\r\n\r\n    try {\r\n      const negociacoes = await this._service.obtemNegociacoesDoPeriodo();\r\n      console.log(negociacoes);\r\n      negociacoes.filter(novaNegociacao =>\r\n        !this._negociacoes.paraArray().some(negociacaoExistente =>\r\n          novaNegociacao.equals(negociacaoExistente)))\r\n      .forEach(negociacao => this._negociacoes.adiciona(negociacao));\r\n      this._mensagem.texto = 'Negociações do período importadas com sucesso!';\r\n    } catch(err) {\r\n        this._mensagem.texto = err.message;\r\n    }\r\n  }\r\n\r\n  async apaga() {\r\n    try {\r\n      const dao = await getNegociacaoDao();\r\n      await dao.apagaTodos();\r\n      this._negociacoes.esvazia();\r\n      this._mensagem.texto = 'Negociações apagadas com sucesso';\r\n    } catch(err) {\r\n        this._mensagem.texto = err.message;\r\n    }\r\n  }\r\n}"]}