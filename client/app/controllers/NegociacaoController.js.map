{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacaoService","Negociacao","NegociacoesView","MensagemView","Mensagem","DateConverter","getNegociacaoDao","Bind","getExceptionMessage","debounce","controller","NegociacaoController","constructor","inputData","inputQuantidade","inputValor","Object","assign","_inputData","_inputQuantidade","_inputValor","_negociacoes","_mensagem","_service","_init","dao","negociacoes","listaTodos","forEach","adiciona","negociacao","err","texto","event","preventDefault","_criaNegociacao","_limpaFormulario","message","value","focus","paraData","parseInt","parseFloat","importaNegociacoes","obtemNegociacoesDoPeriodo","console","log","filter","paraArray","some","novaNegociacao","equals","negociacaoExistente","apaga","apagaTodos","esvazia"],"mappings":";;;;;;AAASA,iB,kBAAAA,W;AAAaC,uB,kBAAAA,iB;AAAmBC,gB,kBAAAA,U;;AAChCC,qB,cAAAA,e;AAAiBC,kB,cAAAA,Y;AAAcC,c,cAAAA,Q;AAAUC,mB,cAAAA,a;;AACzCC,sB,gBAAAA,gB;AAAkBC,U,gBAAAA,I;AAAMC,yB,gBAAAA,mB;AAAqBC,c,gBAAAA,Q;AAAUC,gB,gBAAAA,U;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UAGnDC,oB,WADZD,WAAW,OAAX,EAAoB,aAApB,EAAmC,QAAnC,C,UAqCED,U,UAkCAA,SAAS,IAAT,C,2BAtEI,MAAME,oBAAN,CAA0B;;AAE/BC,oBAAYC,SAAZ,EAAuBC,eAAvB,EAAwCC,UAAxC,EAAoD;;AAElDC,iBAAOC,MAAP,CAAc,IAAd,EAAoB,EAACC,UAAD,EAAaC,gBAAb,EAA+BC,WAA/B,EAApB;;AAEA;AACA,eAAKC,YAAL,GAAoB,IAAId,IAAJ,CAClB,IAAIR,WAAJ,EADkB,EAElB,IAAIG,eAAJ,CAAoB,cAApB,CAFkB,EAGlB,UAHkB,EAGN,SAHM,CAApB;;AAMA,eAAKoB,SAAL,GAAiB,IAAIf,IAAJ,CACf,IAAIH,QAAJ,EADe,EAEf,IAAID,YAAJ,CAAiB,eAAjB,CAFe,EAGf,OAHe,CAAjB;;AAMA,eAAKoB,QAAL,GAAgB,IAAIvB,iBAAJ,EAAhB;;AAEA,eAAKwB,KAAL;AAED;;AAEKA,aAAN,GAAc;AAAA;;AAAA;AACZ,gBAAI;AACF,oBAAMC,MAAM,MAAMnB,kBAAlB;AACA,oBAAMoB,cAAc,MAAMD,IAAIE,UAAJ,EAA1B;AACAD,0BAAYE,OAAZ,CAAoB;AAAA,uBAAc,MAAKP,YAAL,CAAkBQ,QAAlB,CAA2BC,UAA3B,CAAd;AAAA,eAApB;AACD,aAJD,CAIE,OAAMC,GAAN,EAAW;;AAET,oBAAKT,SAAL,CAAeU,KAAf,GAAuBxB,oBAAoBuB,GAApB,CAAvB;AACH;AARW;AASb;;AAGKF,gBAAN,CAAeI,KAAf,EAAsB;AAAA;;AAAA;;AAEpB,gBAAI;AACF;AACAA,oBAAMC,cAAN;AACA,oBAAMJ,aAAa,OAAKK,eAAL,EAAnB;;AAEA,oBAAMV,MAAM,MAAMnB,kBAAlB;AACA,oBAAMmB,IAAII,QAAJ,CAAaC,UAAb,CAAN;AACA,qBAAKT,YAAL,CAAkBQ,QAAlB,CAA2BC,UAA3B;AACA,qBAAKR,SAAL,CAAeU,KAAf,GAAuB,oCAAvB;AACA,qBAAKI,gBAAL;AACD,aAVD,CAUE,OAAML,GAAN,EAAW;AACX,qBAAKT,SAAL,CAAeU,KAAf,GAAuBD,IAAIM,OAA3B;AACD;AAdmB;AAerB;;AAEDD,2BAAmB;AACjB,eAAKlB,UAAL,CAAgBoB,KAAhB,GAA8B,EAA9B;AACA,eAAKnB,gBAAL,CAAsBmB,KAAtB,GAA8B,CAA9B;AACA,eAAKlB,WAAL,CAAiBkB,KAAjB,GAA8B,GAA9B;AACA,eAAKpB,UAAL,CAAgBqB,KAAhB;AACD;;AAEDJ,0BAAkB;AAChB;AACA,iBAAO,IAAIlC,UAAJ,CACLI,cAAcmC,QAAd,CAAuB,KAAKtB,UAAL,CAAgBoB,KAAvC,CADK,EAELG,SAAS,KAAKtB,gBAAL,CAAsBmB,KAA/B,CAFK,EAGLI,WAAW,KAAKtB,WAAL,CAAiBkB,KAA5B,CAHK,CAAP;AAKD;;AAGKK,0BAAN,GAA2B;AAAA;;AAAA;;AAEzB,gBAAI;AACF,oBAAMjB,cAAc,MAAM,OAAKH,QAAL,CAAcqB,yBAAd,EAA1B;AACAC,sBAAQC,GAAR,CAAYpB,WAAZ;AACAA,0BAAYqB,MAAZ,CAAmB;AAAA,uBACjB,CAAC,OAAK1B,YAAL,CAAkB2B,SAAlB,GAA8BC,IAA9B,CAAmC;AAAA,yBAClCC,eAAeC,MAAf,CAAsBC,mBAAtB,CADkC;AAAA,iBAAnC,CADgB;AAAA,eAAnB,EAGCxB,OAHD,CAGS;AAAA,uBAAc,OAAKP,YAAL,CAAkBQ,QAAlB,CAA2BC,UAA3B,CAAd;AAAA,eAHT;AAIA,qBAAKR,SAAL,CAAeU,KAAf,GAAuB,gDAAvB;AACD,aARD,CAQE,OAAMD,GAAN,EAAW;AACT,qBAAKT,SAAL,CAAeU,KAAf,GAAuBD,IAAIM,OAA3B;AACH;AAZwB;AAa1B;;AAEKgB,aAAN,GAAc;AAAA;;AAAA;AACZ,gBAAI;AACF,oBAAM5B,MAAM,MAAMnB,kBAAlB;AACA,oBAAMmB,IAAI6B,UAAJ,EAAN;AACA,qBAAKjC,YAAL,CAAkBkC,OAAlB;AACA,qBAAKjC,SAAL,CAAeU,KAAf,GAAuB,kCAAvB;AACD,aALD,CAKE,OAAMD,GAAN,EAAW;AACT,qBAAKT,SAAL,CAAeU,KAAf,GAAuBD,IAAIM,OAA3B;AACH;AARW;AASb;AA/F8B,O","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes, NegociacaoService, Negociacao} from '../domain/index.js'; //'../domain/index.js';\r\nimport { NegociacoesView, MensagemView, Mensagem, DateConverter } from '../ui/index.js';\r\nimport { getNegociacaoDao, Bind, getExceptionMessage, debounce, controller } from '../util/index.js';\r\n\r\n@controller('#data', '#quantidade', '#valor')\r\nexport class NegociacaoController{\r\n\r\n  constructor(inputData, inputQuantidade, inputValor) {\r\n    \r\n    Object.assign(this, {_inputData, _inputQuantidade, _inputValor})\r\n    \r\n    //criando o proxy com auxílio do Bind\r\n    this._negociacoes = new Bind(\r\n      new Negociacoes(),\r\n      new NegociacoesView('#negociacoes'),\r\n      'adiciona', 'esvazia'\r\n    );\r\n    \r\n    this._mensagem = new Bind(\r\n      new Mensagem(),\r\n      new MensagemView('#mensagemView'),\r\n      'texto'\r\n    );\r\n    \r\n    this._service = new NegociacaoService();\r\n    \r\n    this._init();\r\n    \r\n  }\r\n\r\n  async _init() {\r\n    try {\r\n      const dao = await getNegociacaoDao();\r\n      const negociacoes = await dao.listaTodos();\r\n      negociacoes.forEach(negociacao => this._negociacoes.adiciona(negociacao));\r\n    } catch(err) {\r\n      \r\n        this._mensagem.texto = getExceptionMessage(err);\r\n    }\r\n  }\r\n\r\n  @debounce()\r\n  async adiciona(event) {\r\n\r\n    try {\r\n      // cancelando  a submissão do formulário\r\n      event.preventDefault();\r\n      const negociacao = this._criaNegociacao();\r\n    \r\n      const dao = await getNegociacaoDao();\r\n      await dao.adiciona(negociacao);\r\n      this._negociacoes.adiciona(negociacao);\r\n      this._mensagem.texto = 'Negociação adicionada com sucesso!';\r\n      this._limpaFormulario();\r\n    } catch(err) {\r\n      this._mensagem.texto = err.message;\r\n    }\r\n  }\r\n  \r\n  _limpaFormulario() {\r\n    this._inputData.value       = '';\r\n    this._inputQuantidade.value = 1;\r\n    this._inputValor.value      = 0.0\r\n    this._inputData.focus();\r\n  }\r\n\r\n  _criaNegociacao() {\r\n    //retorna uma instancia de nogociação\r\n    return new Negociacao(\r\n      DateConverter.paraData(this._inputData.value)  ,\r\n      parseInt(this._inputQuantidade.value),\r\n      parseFloat(this._inputValor.value)\r\n    );\r\n  }\r\n  \r\n  @debounce(1500)\r\n  async importaNegociacoes() {\r\n\r\n    try {\r\n      const negociacoes = await this._service.obtemNegociacoesDoPeriodo();\r\n      console.log(negociacoes);\r\n      negociacoes.filter(novaNegociacao =>\r\n        !this._negociacoes.paraArray().some(negociacaoExistente =>\r\n          novaNegociacao.equals(negociacaoExistente)))\r\n      .forEach(negociacao => this._negociacoes.adiciona(negociacao));\r\n      this._mensagem.texto = 'Negociações do período importadas com sucesso!';\r\n    } catch(err) {\r\n        this._mensagem.texto = err.message;\r\n    }\r\n  }\r\n\r\n  async apaga() {\r\n    try {\r\n      const dao = await getNegociacaoDao();\r\n      await dao.apagaTodos();\r\n      this._negociacoes.esvazia();\r\n      this._mensagem.texto = 'Negociações apagadas com sucesso';\r\n    } catch(err) {\r\n        this._mensagem.texto = err.message;\r\n    }\r\n  }\r\n}"]}