{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacoesView","Mensagem","MensagemView","NegociacaoService","getNegociacaoDao","DataInvalidaException","Negociacao","Bind","DateConverter","NegociacaoController","constructor","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_negociacoes","_mensagem","_service","_init","then","dao","listaTodos","negociacoes","forEach","negociacao","adiciona","catch","err","texto","event","preventDefault","_criaNegociacao","_limpaFormulario","console","log","stack","message","value","focus","paraData","parseInt","parseFloat","importaNegociacoes","obtemNegociacoesDoPeriodo","filter","novaNegociacao","paraArray","some","negociacaoExistente","equals","apaga","apagaTodos","esvazia"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes } from '../domain/negociacao/Negociacoes.js';\r\nimport { NegociacoesView } from '../ui/views/NegociacoesView.js';\r\nimport { Mensagem } from '../ui/models/Mensagem.js';\r\nimport { MensagemView } from '../ui/views/MensagemView.js';\r\nimport { NegociacaoService } from '../domain/negociacao/NegociacaoService.js';\r\nimport { getNegociacaoDao } from '../util/DaoFactory.js';\r\nimport { DataInvalidaException } from '../ui/converters/DataInvalidaException.js';\r\nimport { Negociacao } from '../domain/negociacao/Negociacao.js.';\r\nimport { Bind } from '../util/Bind.js';\r\nimport { DateConverter } from '../ui/converters/DateConverter.js';\r\n\r\nexport class NegociacaoController{\r\n\r\n  constructor(){\r\n    // a ideia é que $ seja o querySelector\r\n    // realizando o bind, $ mantém document como seu contexto this\r\n    const $ = document.querySelector.bind(document);  \r\n\r\n    // buscando elementos\r\n    this._inputData       = $('#data');\r\n    this._inputQuantidade = $('#quantidade');\r\n    this._inputValor      = $('#valor');\r\n\r\n    //criando o proxy com auxílio do Bind\r\n    this._negociacoes = new Bind(\r\n      new Negociacoes(),\r\n      new NegociacoesView('#negociacoes'),\r\n      'adiciona', 'esvazia'\r\n    );\r\n    \r\n    this._mensagem = new Bind(\r\n      new Mensagem(),\r\n      new MensagemView('#mensagemView'),\r\n      'texto'\r\n    );\r\n    \r\n    this._service = new NegociacaoService();\r\n    \r\n    this._init();\r\n    \r\n  }\r\n\r\n  _init() {\r\n      getNegociacaoDao()\r\n      .then(dao => dao.listaTodos())\r\n      .then(negociacoes =>\r\n          negociacoes.forEach(negociacao =>\r\n            this._negociacoes.adiciona(negociacao)))\r\n      .catch(err => this._mensagem.texto = err);\r\n  }\r\n\r\n  adiciona(event){\r\n    // cancelando  a submissão do formulário\r\n    event.preventDefault();\r\n    \r\n    try {\r\n      const negociacao = this._criaNegociacao();\r\n    \r\n      getNegociacaoDao()\r\n      .then(dao => dao.adiciona(negociacao))\r\n      .then(() => {\r\n        this._negociacoes.adiciona(negociacao);\r\n        this._mensagem.texto = 'Negociação adicionada com sucesso!';\r\n        this._limpaFormulario();\r\n      })\r\n      .catch(err => this._mensagem.texto = err);\r\n\r\n    } catch (err) {\r\n        console.log(err);\r\n        console.log(err.stack);\r\n\r\n        if(err instanceof DataInvalidaException) {\r\n          this._mensagem.texto = err.message;\r\n        } else {\r\n          //mensagem generica para qualquer problema diferente que aconteça\r\n          this._mensagem.texto = 'Um erro não esperado aconteceu. Entre em contato com o suporte.';\r\n        }        \r\n    }\r\n  }\r\n  \r\n  _limpaFormulario() {\r\n    this._inputData.value       = '';\r\n    this._inputQuantidade.value = 1;\r\n    this._inputValor.value      = 0.0\r\n    this._inputData.focus();\r\n  }\r\n\r\n  _criaNegociacao() {\r\n    //retorna uma instancia de nogociação\r\n    return new Negociacao(\r\n      DateConverter.paraData(this._inputData.value)  ,\r\n      parseInt(this._inputQuantidade.value),\r\n      parseFloat(this._inputValor.value)\r\n    );\r\n  }\r\n  \r\n  importaNegociacoes() {\r\n    this._service\r\n      .obtemNegociacoesDoPeriodo()\r\n      .then(negociacoes => {\r\n        negociacoes\r\n        .filter(novaNegociacao => !this._negociacoes.paraArray().some(negociacaoExistente =>\r\n          novaNegociacao.equals(negociacaoExistente)))\r\n        .forEach(negociacao => this._negociacoes.adiciona(negociacao));\r\n        this._mensagem.texto = 'Negociações do período importadas com sucesso!';\r\n      })\r\n      .catch(err => this._mensagem.texto = err);\r\n  }\r\n\r\n  apaga() {\r\n    getNegociacaoDao()\r\n    .then(dao => dao.apagaTodos())\r\n    .then(() => {\r\n      this._negociacoes.esvazia();\r\n      this._mensagem.texto = 'Negociações apagadas com sucesso';\r\n    })\r\n    .catch(err => this._mensagem.texto = err);\r\n  }\r\n}"]}